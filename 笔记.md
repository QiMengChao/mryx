# 项目优化
	   
## 头部组件技术要点

- 牵扯到多个页面用到图标问题
- 通过行内绑定style  :style="backgroundImage: `url(${icon})`"
- props: {icon: String}
- 页面使用 <HeaderTop :icon="icon" />		
  需要注意的是这个icon不能直接写相对路径  需要用require引入 即
  data() {
 	require('相对路径') 
	}
- 首页的navBar和其他页面的navBar差距较大，所有使用了props传递style对象、style绑定、class绑定以及三元组表达式结合，复用了navBar组件而没有重新映入mintui的navbar，总体是提高了组件的可复用性吧。


## 使用less
	
	cnpm install less less-loader -S-D

## 使用swiper

	cnpm install swiper -S-D
	在组件中引入
	//引用swiper
	import Swiper from 'swiper' 
	//引入css文件
	import 'swiper/dist/css/swiper.min.css'
	
	然后在挂载的时候初始化swiper
	mounted() {
		    new Swiper('.swiper-container', {
		     //    direction: 'vertical', // 垂直切换选项
			    // loop: true, // 循环模式选项
			    autoplay: true,
			    // 如果需要分页器
		        pagination: {
		          el: '.swiper-pagination',
		        },
		    })
	}

## 使用mint-ui

	cnpm install mint-ui -S
	cnpm install babel-plugin-component -S-D
	打开.babelrc进行配置，在plugin插入一项配置
	例如："plugins": ["transform-vue-jsx", "transform-runtime", ["component", [
		  {
		    "libraryName" : "mint-ui",
		    "style": true
		  }
		  ]]]
	//此处是插入了component这个
	使用：main.js中import 'mint-ui/lib/style.css'
				  import {Navbar, TabItem} from 'mint-ui' 

### mint-ui组件分类

	a. 标签组件
	b. 非标签组件

    在main.js进行要使用的组件的注册
    	//先引入要使用的组件
    	import 'mint-ui/lib/style.css'
    	import {Button} from 'mint-ui'

    	//注册为全局组件
    	Vue.component(Button.name, Button)
    	//然后就可以在所有页面中使用
		<mt-button></mt-button>
	注意：如果需要修改mint-ui组件的默认样式，并且给定的组件是封装起来的不能写行内，即时找到了要修改的样式的类选择器，然后在该vue组件中修改该类选择器的样式是无效的（当然去掉scoped是有效的，但是这样并不合理），如何解决：
	- 首先就要理清mint-ui组件的渲染的机制
	- 在vue中使用的仅仅是声明这个组件
	- 在页面中展示，需要借组mint-ui-css把组件的样式附上
	- 那么如果要修改，就单独定义一个css文件，在引入（import）,mint-ui-css之后再引入它就可以达到修改mint-ui组件默认样式的效果（注，这些操作都是在main.js中进行）

### 使用vuex

	cnpm install vuex -S
	创建store文件夹
		- index.js
		- state.js
		- getters.js
		- mutation-types.js
		- actions.js
		- mutations.js
		需要注意：每个.js文件写的时候都需要注意导出 export default{} 或 export const ....
				 并且state getters actions mutations都是有多个  每个间要用,号隔开
	在index.js 中分别引入(import)state.js getters.js actions.js mutations.js vue vuex
		使用vuex	   Vue.use(vuex)
		创建vuex   export default Vuex.Store({
						state,
						getters,
						actions,
						mutations,	
					})
	在main.js中为vue实例挂载vuex
		引入store/index.js
		在实例中挂载

### 使用animate.css

	cnpm install animate.css
	在main.js中引入import animate from 'animate.css'	
	在页面中使用<transition enter-active-class="animated fadeIn"></transition>

### 使用better-scroll

	使用better-scroll实现各种滚动效果
	npm install better-scroll -S
	具体使用看官方文档https://ustbhuangyi.github.io/better-scroll/doc/zh-hans/installation.html#npm
	this.$nextTick(() => {
		if(!this.scroll) {
			this.scroll = new BScroll(this.$refs.wrapper, {
				click: true
			})
		} else {
			this.scroll.refresh()
		}
	})
	需要注意的是子元素的高度一定要大于父元素的高度，子元素设置超出隐藏

## 利用mint-ui的navbar封装自定义的NavBar
	
	通过利用v-for再次封装mint-ui的navbar
	实现自定义tab的个数以及icon

## navbar结合tabcontainer一起使用

	封装一个FoodList组件
	<mt-tab-container v-model="active">
	  <mt-tab-container-item id="tab-container1">
	    <mt-cell v-for="n in 10" title="tab-container 1"></mt-cell>
	  </mt-tab-container-item>
	  <mt-tab-container-item id="tab-container2">
	    <mt-cell v-for="n in 5" title="tab-container 2"></mt-cell>
	  </mt-tab-container-item>
	  <mt-tab-container-item id="tab-container3">
	    <mt-cell v-for="n in 7" title="tab-container 3"></mt-cell>
	  </mt-tab-container-item>
	</mt-tab-container>
	两个要点： 这个active必须和navbar的selectedIndex同步  Ps:必须是全局的
			  下面的id就根据有多少个navbar来v-for


## 点击其他隐藏已打开的cityselector弹窗

	给Home对应的最外层的div绑定单击事件 使用事件修饰符.capture 即实现单击页面中的任意元素 会先执行这个单击事件（隐藏）
	把cityselector放在它下面一级

## 跨域访问接口

	正常情况下，要实现跨域，是通过后台进行配置响应的响应头的参数。
	vue-cli则跨域通过node.js代理服务器实现跨域请求
	文件路径 config/index.js
		proxyTable: {
		   '/api': { // 匹配所有以 '/api'开头的请求路径  即匹配的是axios中传入的url参数，/api/user  这种形式才会匹配
		     target: 'http://d.apicloud.com/mcm/api', // 代理目标的基础路径
		     changeOrigin: true, // 支持跨域
		     pathRewrite: {// 重写路径: 去掉路径中开头的'/api'  当真正的接口不需要api时重写
		       '^/api': ''  //去掉匹配到的路径的/api  如果不去掉就删除pathRewrite
		     }
		   } 
		}
		//最后得到的路径就是 target+url
		//假设请求的url为 /api/user
		//经过node.js代理后  真正请求的是 http://d.apicloud.com/mcm/api/user
		//需要注意的是F12显示的仍然是localhost:8080/api/usesr  但实际上发送的地址是经过node.js代理服务器实现的跨域请求

	请求头
		const instance = axios.create({
		  baseURL: '/api',
		  timeout: 1000,
		  headers: {
		  	'X-APICloud-AppId': 'A6914327011091',
		  	'X-APICloud-AppKey': '8ac17d22e49cb7982d82796097cec52a6c7cd01d.1475375422841'
		  }
		})
		//get请求
		promise = instance.get(url)
		//post请求
		promise = instance.post(url)

## 关于浮点数计算的问题

	state.totalPrice = parseFloat((state.totalPrice + food.price).toFixed(2))
	需要注意：不能直接(state.totalPrice + food.price).toFixed(2)
			 因为toFixed() 返回一个数值的字符串表现形式。

## 新打开的页面的名称

	使用插槽进行显示
	组件中定义
	<slot name="winName"></slot>

	页面中使用
	<HeaderTop>
		<template v-slot:winName>我的优惠卷</template>
	</HeaderTop>

## 关于购物车模块的状态管理

	由于购物车中设置了选中以及不选中
	所以当不选中已添加至购物车的食物时，应该将不选中的食物依次从cartFoods中提取相应的食物至tempCartFoods中（需要注意的是原cartFoods保存）然后对totalPrice进行减操作、totalCount进行减操作
	选中，则根据tempCartFoods中的食物来对totalPrice和totalCount进行加操作

## 首页左右滑动效果

	组件用的是mint-ui提供的当时 存在一个问题  它只提供了滑动效果 不会和tab动态的关联起来，所以借助了vue-touch
	vue-touch使用: 
		cnpm install vue-touch@text
	main.js绑定vue
		import VueTouch from 'vue-touch'
		Vue.use(VueTouch, {name: 'v-touch'})
	FoodList中使用
		<v-touch @swipeLeft=""></v-touch>  //从左往右滑动
		<v-touch @swipeRight=""></v-touch> //从右往左滑
	    绑定事件，使用this.$emit('v-swipeLeft')  //自定义事件
	Home中使用
		<FoodList @v-swipeLeft=""/>
		绑定事件
			触发nav的updateSelectedIndex事件
			通过this.$refs.nav.updateSelectedIndex(更改的下标) //要先给nav绑定ref="nav"
	优化建议：是否可以通过watch监听navBar的下标变化，如果变化了，在this.$nextTick中执行初始化方法

## 关于水果轮播多次滑动后不能自动播放的问题解决
	
	先把轮播初始化的代码封装一个方法swiperInit()
	在页面第一次载入的时候(mounted)调用该函数
	在左右滑动后(由于使用了v-touch每次滑动会触发updated())，即在updated中调用该函数。

## 城市选择滚动问题解决

	初次判断错误：认为是原来home页面的滚动，实则是城市选择那个大的背景（透明）自带的滚动效果
	解决方法：使用css3属性touch-action:none  禁止页面的手势响应

## axios发送请求超时

	起初是设置了timeout为1000,改了6000就没问题了
	const instance = axios.create({
	  baseURL: '/api',
	  timeout: 6000,
	  headers: {
	  	'X-APICloud-AppId': 'A6914327011091',
	  	'X-APICloud-AppKey': '8ac17d22e49cb7982d82796097cec52a6c7cd01d.1475375422841'
	  }
	})

## 收获地址路由划分

	添加地址、修改地址都归并到收获地址的子路由下

## 放到服务器发送请求失败问题

	需要更改axios的baseURL
    baseURL: 'http://d.apicloud.com/mcm/api',  //生产环境

	baseURL: '/api',  //开发环境

## 项目打包文件分析与优化

	npm run build --report  
	推荐库：date-fns 日期库

## mockjs图片资源
	
	安装： cnpm install mockjs -S
	在mock文件目录下新建
		data.js  
		   格式： Json数据类型
		mockServer.js
		   import Mock from 'mockjs'
		   import data from './data.json'

		   // 返回水果的接口
		   Mock.mock('/fruits', {code:0, data: data.fruits})
		   // 返回食材的接口
		   Mock.mock('/ingredients', {code:0, data: data.ingredients})
		   // 返回零食的接口
		   Mock.mock('/snacks', {code:0, data: data.snacks})
		   //返回牛奶的接口
		   Mock.mock('/milks', {code:0, data: data.milks})
		   //返回蔬菜的接口
		   Mock.mock('/vegetables', {code:0, data: data.vegetables})
	在main.js中引入 
		import './mock/mockServer.js'

## 关于better-scroll滚动的时单击多次问题的解决

	应该创建better-scroll实例  而不是直接使用匿名的方式创建
	并且在需要滚动的.vue文件中的updated方法中调用refresh()方法，清空滚动的click




	
	
